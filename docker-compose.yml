services:
  everycal:
    build: .
    ports:
      - "3000:3000"
    volumes:
      - everycal-data:/data
      - everycal-uploads:/app/uploads
      # Scrapers: mount scraper-api-keys.json when using scrapers (create via setup-scraper-accounts.sh)
      # - ./scraper-api-keys.json:/secrets/scraper-api-keys.json:ro
    environment:
      - NODE_ENV=production
      - DATABASE_PATH=/data/everycal.db
      - UPLOAD_DIR=/app/uploads
      - RUN_JOBS_INTERNALLY=true
      - SCRAPER_API_KEYS_FILE=/secrets/scraper-api-keys.json
      # - SCRAPER_API_KEYS_JSON=${SCRAPER_API_KEYS_JSON} # alternatively, pass JSON inline (e.g. from Docker secret)
      - JOBS_API_SERVER=${JOBS_API_SERVER:-http://localhost:3000}
      - PORT=${PORT:-3000}
      - BASE_URL=${BASE_URL:-http://localhost:3000}
      - CORS_ORIGIN=${CORS_ORIGIN:-${BASE_URL}}
      - OPEN_REGISTRATIONS=${OPEN_REGISTRATIONS:-true}
      - TRUSTED_PROXY=${TRUSTED_PROXY:-false}
      - UNSPLASH_ACCESS_KEY=${UNSPLASH_ACCESS_KEY:-}
      - SKIP_SIGNATURE_VERIFY=${SKIP_SIGNATURE_VERIFY:-false} # dev only
      - SMTP_HOST=${SMTP_HOST:-}
      - SMTP_PORT=${SMTP_PORT:-}
      - SMTP_SECURE=${SMTP_SECURE:-}
      - SMTP_USER=${SMTP_USER:-}
      - SMTP_PASS=${SMTP_PASS:-}
      - SMTP_FROM=${SMTP_FROM:-}
    restart: unless-stopped

volumes:
  everycal-data:
  everycal-uploads:
